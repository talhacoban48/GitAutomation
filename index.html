<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Git Automation</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --accent:#2563eb; --muted:#6b7280; 
      --danger:#dc2626; --radius:12px; --border:#e6e9ef;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:#111827;overflow:hidden}
    .page{height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:100%;max-width:680px;max-height:100%;background:var(--card);border-radius:var(--radius);padding:24px;box-shadow:0 8px 30px rgba(15,23,42,0.08);overflow-y:auto}
    h1{font-size:20px;margin:0 0 6px}
    .lead{margin:0 0 16px;color:var(--muted);font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px 16px}
    .full{grid-column:1 / -1}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted);font-weight:500}
    .muted{font-size:12px;color:#9ca3af;margin-left:6px;font-weight:400}
    input[type="text"], input[type="number"]{
      width:100%;padding:10px 12px;border-radius:8px;border:1px solid var(--border);font-size:14px;
      transition:border-color 0.2s;
    }
    input:focus{outline:none;border-color:var(--accent)}
    .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:16px}
    .btn{padding:10px 16px;border-radius:8px;border:0;background:var(--accent);color:#fff;cursor:pointer;font-size:14px;font-weight:500;transition:background 0.2s}
    .btn:hover{background:#1d4ed8}
    .row{display:flex;gap:8px;align-items:flex-start}
    .custom-select-wrap{flex:1;position:relative}
    .custom-select{
      width:100%;padding:10px 36px 10px 12px;border-radius:8px;border:1px solid var(--border);
      font-size:14px;background:#fff;cursor:pointer;display:flex;align-items:center;
      justify-content:space-between;transition:border-color 0.2s;
    }
    .custom-select:hover{border-color:#d1d5db}
    .custom-select.active{border-color:var(--accent)}
    .custom-select-arrow{position:absolute;right:12px;top:50%;transform:translateY(-50%);pointer-events:none;color:var(--muted);font-size:12px;transition:transform 0.2s}
    .custom-select.active .custom-select-arrow{transform:translateY(-50%) rotate(180deg)}
    .custom-select-dropdown{
      position:absolute;top:calc(100% + 4px);left:0;right:0;background:#fff;
      border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 12px rgba(15,23,42,0.1);
      max-height:180px;overflow-y:auto;z-index:100;display:none;
    }
    .custom-select-dropdown.active{display:block}
    .custom-select-option{
      padding:10px 12px;cursor:pointer;display:flex;align-items:center;
      justify-content:space-between;transition:background 0.15s;font-size:14px;
    }
    .custom-select-option:hover{background:#f9fafb}
    .custom-select-option.selected{background:#eff6ff;color:var(--accent)}
    .option-delete{
      padding:4px 8px;border-radius:6px;border:1px solid rgba(220,38,38,0.2);
      background:#fff;color:var(--danger);cursor:pointer;font-size:12px;
      transition:all 0.15s;opacity:0;
    }
    .custom-select-option:hover .option-delete{opacity:1}
    .option-delete:hover{background:#fef2f2;border-color:var(--danger)}
    .icon-btn{
      padding:10px 12px;border-radius:8px;border:1px solid var(--border);
      background:#fff;cursor:pointer;transition:all 0.2s;min-width:42px;
    }
    .icon-btn:hover{background:#f9fafb;border-color:#d1d5db}
    .icon-btn i{font-size:14px;color:var(--muted)}
    @media (max-width:640px){
      .grid{grid-template-columns:1fr}
      .actions{justify-content:stretch}
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <h1>Git Automation</h1>
      <p class="lead">PR bilgilerini girin. (İsteğe bağlı alanlar belirtildi.)</p>

      <form id="gitForm" class="grid" autocomplete="off">
        <!-- 1) PR will merge to? (custom select) -->
        <div class="full">
          <label>PR will merge to?</label>
          <div class="row">
            <div class="custom-select-wrap">
              <div class="custom-select" id="targetBranchSelect">
                <span class="select-value">dev</span>
                <i class="fa fa-chevron-down custom-select-arrow"></i>
              </div>
              <div class="custom-select-dropdown" id="targetBranchDropdown"></div>
            </div>
            <button type="button" id="addBranchBtn" class="icon-btn" title="Yeni ekle">
              <i class="fa fa-plus"></i>
            </button>
          </div>
        </div>

        <!-- 2) Issue number -->
        <div>
          <label for="issueNumber">Issue number</label>
          <input id="issueNumber" name="issueNumber" type="number" min="0" placeholder="Enter Issue Number" />
        </div>

        <!-- 3) Branch Name (Optional) -->
        <div>
          <label for="branchName">Branch Name <span class="muted">(Optional)</span></label>
          <input id="branchName" name="branchName" type="text" placeholder="Enter Optional Branch Name" />
        </div>

        <!-- 4) Commit Message -->
        <div class="full">
          <label for="commitMessage">Commit Message</label>
          <input id="commitMessage" name="commitMessage" type="text" placeholder="Enter Commit Message" />
        </div>

        <!-- 5) Issue Repository is? (custom select) -->
        <div class="full">
          <label>Issue Repository is?</label>
          <div class="row">
            <div class="custom-select-wrap">
              <div class="custom-select" id="repoSelect">
                <span class="select-value">current</span>
                <i class="fa fa-chevron-down custom-select-arrow"></i>
              </div>
              <div class="custom-select-dropdown" id="repoDropdown"></div>
            </div>
            <button type="button" id="addRepoBtn" class="icon-btn" title="Yeni ekle">
              <i class="fa fa-plus"></i>
            </button>
          </div>
        </div>

        <div class="full actions">
          <button type="submit" class="btn">Create PR Payload</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Custom Select Implementation
    class CustomSelect {
      constructor(selectEl, dropdownEl, storageKey, defaultOptions) {
        this.selectEl = selectEl;
        this.dropdownEl = dropdownEl;
        this.storageKey = storageKey;
        this.valueEl = selectEl.querySelector('.select-value');
        
        // Load options from localStorage or use defaults
        this.options = JSON.parse(localStorage.getItem(storageKey) || 'null');
        if (!Array.isArray(this.options) || this.options.length === 0) {
          this.options = defaultOptions;
        }
        
        this.selectedValue = this.options[0];
        this.init();
      }
      
      init() {
        this.render();
        
        // Toggle dropdown
        this.selectEl.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggle();
        });
        
        // Close on outside click
        document.addEventListener('click', () => {
          this.close();
        });
        
        this.dropdownEl.addEventListener('click', (e) => {
          e.stopPropagation();
        });
      }
      
      render() {
        this.dropdownEl.innerHTML = '';
        this.options.forEach(opt => {
          const optEl = document.createElement('div');
          optEl.className = 'custom-select-option';
          if (opt === this.selectedValue) optEl.classList.add('selected');
          
          const span = document.createElement('span');
          span.textContent = opt;
          
          const delBtn = document.createElement('button');
          delBtn.className = 'option-delete';
          delBtn.textContent = '×';
          delBtn.title = 'Sil';
          delBtn.type = 'button';
          
          delBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            this.deleteOption(opt);
          });
          
          optEl.addEventListener('click', () => {
            this.selectOption(opt);
          });
          
          optEl.appendChild(span);
          optEl.appendChild(delBtn);
          this.dropdownEl.appendChild(optEl);
        });
        
        this.valueEl.textContent = this.selectedValue;
      }
      
      toggle() {
        const isActive = this.dropdownEl.classList.contains('active');
        // Close all other dropdowns
        document.querySelectorAll('.custom-select-dropdown').forEach(d => {
          d.classList.remove('active');
        });
        document.querySelectorAll('.custom-select').forEach(s => {
          s.classList.remove('active');
        });
        
        if (!isActive) {
          this.dropdownEl.classList.add('active');
          this.selectEl.classList.add('active');
        }
      }
      
      close() {
        this.dropdownEl.classList.remove('active');
        this.selectEl.classList.remove('active');
      }
      
      selectOption(value) {
        this.selectedValue = value;
        this.render();
        this.close();
      }
      
      addOption(value) {
        if (this.options.includes(value)) {
          alert('Bu seçenek zaten mevcut.');
          return false;
        }
        this.options.push(value);
        this.save();
        this.render();
        return true;
      }
      
      deleteOption(value) {
        if (this.options.length <= 1) {
          alert('En az bir seçenek olmalı.');
          return;
        }
        
        if (!confirm(`${value} seçeneğini silmek istediğinize emin misiniz?`)) return;
        
        this.options = this.options.filter(x => x !== value);
        if (this.selectedValue === value) {
          this.selectedValue = this.options[0];
        }
        this.save();
        this.render();
      }
      
      save() {
        localStorage.setItem(this.storageKey, JSON.stringify(this.options));
      }
      
      getValue() {
        return this.selectedValue;
      }
    }

    // Initialize custom selects
    const BRANCH_KEY = 'git_ui_branchOptions_v1';
    const REPO_KEY = 'git_ui_repoOptions_v1';

    const branchSelect = new CustomSelect(
      document.getElementById('targetBranchSelect'),
      document.getElementById('targetBranchDropdown'),
      BRANCH_KEY,
      ['dev', 'stage', 'main']
    );

    const repoSelectObj = new CustomSelect(
      document.getElementById('repoSelect'),
      document.getElementById('repoDropdown'),
      REPO_KEY,
      ['current', 'repo-a', 'repo-b']
    );

    // Add button handlers
    document.getElementById('addBranchBtn').addEventListener('click', () => {
      const newVal = prompt('Yeni branch adı:');
      if (!newVal) return;
      const val = newVal.trim();
      if (!val) return;
      branchSelect.addOption(val);
    });

    document.getElementById('addRepoBtn').addEventListener('click', () => {
      const newVal = prompt('Yeni repo adı:');
      if (!newVal) return;
      const val = newVal.trim();
      if (!val) return;
      repoSelectObj.addOption(val);
    });

    // Form submit
    document.getElementById('gitForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const payload = {
        targetBranch: branchSelect.getValue(),
        issueNumber: document.getElementById('issueNumber').value || null,
        branchName: document.getElementById('branchName').value || null,
        commitMessage: document.getElementById('commitMessage').value || null,
        repo: repoSelectObj.getValue()
      };
      console.log('PR payload:', payload);
      alert('Payload konsola yazıldı.');
    });
  </script>
</body>
</html>